// WeShare AI Language Switching Script
// Generates window._weshareLangMap with translated strings before button.js runs

(function () {
  const lang = navigator.language?.split('-')[0] || 'en';
  const supportedLangs = [
    'ja','en','it','es','el','hi','pl','zh','fr','de','ko','pt','ru','ar',
    'nl','vi','et','th','cs','da'
  ];

  const fallbackLang = 'en';
  const finalLang = supportedLangs.includes(lang) ? lang : fallbackLang;
  const stringsToTranslate = [
    'Search for social sharing networks',
    'Copy Link',
    'Post to your blog',
    'Follow',
    'Share via Email',
    'Share to any service'
  ];

  const translatedMap = {};
  let completed = 0;

  window._weshareLangMap = {}; // Global fallback to empty object

  function finalize() {
    window._weshareLangMap = translatedMap;
    console.log('[WeShare AI Language] Translation completed:', translatedMap);
  }

  function fetchTranslation(text) {
    const encodedText = encodeURIComponent(text);
    fetch(`https://weshare-ai-language.vercel.app/api/translate?lang=${finalLang}&text=${encodedText}`)
      .then(res => res.json())
      .then(data => {
        translatedMap[text] = data.translation || text;
        completed++;
        if (completed === stringsToTranslate.length) finalize();
      })
      .catch(() => {
        translatedMap[text] = text;
        completed++;
        if (completed === stringsToTranslate.length) finalize();
      });
  }

  for (const text of stringsToTranslate) {
    fetchTranslation(text);
  }

  console.log('[WeShare AI Language] Running with language:', finalLang);
})();